{% macro alternate_links(locales) %}
    {%- if app.request and app.request.attributes.has('_route') and app.request.attributes.has('_locale') -%}
        {%- for locale in locales -%}

            {% set url = url(
                app.request.attributes.get('_route'),
                app.request.attributes.get('_route_params', {})|merge({'_locale': locale})|merge(app.request.query.all)
            ) %}

            <link rel="alternate" hreflang="{{ locale }}" href="{{ url }}">
        {%- endfor -%}
    {%- endif -%}
{% endmacro %}

{% macro heading(heading) %}

    {%- import '@DarvinContent/macros.html.twig' as darvin_content -%}

    {{- heading }}{{ darvin_content.page_number() -}}
{% endmacro %}

{% macro meta_tags(description) %}

    {%- import '@DarvinContent/macros.html.twig' as darvin_content -%}

    {%- if description -%}
        <meta name="description" content="{{ description }}{{ darvin_content.page_number() }}">
    {% endif %}
{% endmacro %}

{% macro meta_title(title) %}

    {%- import '@DarvinContent/macros.html.twig' as darvin_content -%}

    {{- title }}{{ darvin_content.page_number() -}}
{% endmacro %}

{% macro nav_links() %}
    {% if 1 == app.request.attributes.get('_darvin_content_page_params', [])|length %}

        {% set param = app.request.attributes.get('_darvin_content_page_params')|first %}

        {% for name in ['prev', 'next'] %}

            {% set number = app.request.attributes.get('_darvin_content_page_' ~ name) %}

            {% if number %}

                {% set url = url(
                    app.request.attributes.get('_route'),
                    app.request.attributes.get('_route_params', {})|merge(app.request.query.all)|merge({(param): number})
                ) %}

                <link rel="{{ name }}" href="{{ url }}">
            {% endif %}
        {% endfor %}
    {% endif %}
{% endmacro %}

{% macro page_number() %}

    {%- set number = app.request.attributes.get(constant('Darvin\\ContentBundle\\EventListener\\Pagination\\PagerSubscriber::REQUEST_ATTR_PAGE_NUMBER'), -1) -%}

    {% if number > 1 %}
        {%- trans with {'%number%': number} %}macro.page_number.number{% endtrans -%}
    {% elseif number == 0 %}
        {%- trans with {'%number%': number} %}macro.page_number.all{% endtrans -%}
    {% endif %}
{% endmacro %}

{% macro empty_message() %}
    {% if app.request.headers.has('referer') %}
        {%- set referer = app.request.headers.get('referer') -%}
    {% endif %}

    {%- if referer is defined and referer starts with(app.request.schemeAndHttpHost) and referer != url('darvin_page_homepage') and referer != app.request.uri -%}
        <p class="h3">{% trans with {'%home_url%': path('darvin_page_homepage'), '%referer_url%': referer } %}content.empty_message.with_referer{% endtrans %}</p>
    {%- else -%}
        <p class="h3">{% trans with {'%home_url%': path('darvin_page_homepage') } %}content.empty_message.without_referer{% endtrans %}</p>
    {% endif %}
{% endmacro %}

{% macro message_with_referer(tranlate) %}
    {% if app.request.headers.has('referer') %}
        {%- set referer = app.request.headers.get('referer') -%}
    {% endif %}
    <p class="h3">
        {%- if referer is defined and referer starts with(app.request.schemeAndHttpHost) and referer != url('darvin_page_homepage') and referer != app.request.uri -%}
            {{- (tranlate ~ '.with_referer')|trans({'%home_url%': path('darvin_page_homepage'), '%referer_url%': referer })|raw -}}
        {%- else -%}
            {{- (tranlate ~ '.without_referer')|trans({'%home_url%': path('darvin_page_homepage')})|raw -}}
        {% endif %}
    </p>
{% endmacro %}
