{% macro heading(heading) %}

    {%- import 'DarvinContentBundle::macros.html.twig' as darvin_content -%}

    {{- heading }}{{ darvin_content.page_number() -}}
{% endmacro %}

{% macro meta_tags(description, keywords) %}

    {%- import 'DarvinContentBundle::macros.html.twig' as darvin_content -%}

    {%- if description %}

        <meta name="description" content="{{ description }}{{ darvin_content.page_number() }}">
    {% endif %}
    {% if keywords %}

        <meta name="keywords" content="{{ keywords }}{{ darvin_content.page_number() }}">
    {% endif %}

    {%- set page_params  = app.request.attributes.get(constant('Darvin\\ContentBundle\\EventListener\\Pagination\\PagerSubscriber::REQUEST_ATTR_PAGE_PARAMS')) -%}
    {%- set page_numbers = {} -%}

    {%- for page_param in page_params if 1 == app.request.query.get(page_param) -%}

        {%- set page_numbers = page_numbers|merge({(page_param): null}) -%}

    {%- endfor -%}
    {%- if page_numbers is not empty -%}

        {%- set canonical = path(
            app.request.attributes.get('_route'),
            app.request.attributes.get('_route_params')|merge(app.request.query.all)|merge(page_numbers)
        ) %}

        <link rel="canonical" href="{{ canonical }}">

    {% endif %}
{% endmacro %}

{% macro meta_title(title) %}

    {%- import 'DarvinContentBundle::macros.html.twig' as darvin_content -%}

    {{- title }}{{ darvin_content.page_number() -}}
{% endmacro %}

{% macro page_number() %}

    {%- set number = app.request.attributes.get(constant('Darvin\\ContentBundle\\EventListener\\Pagination\\PagerSubscriber::REQUEST_ATTR_PAGE_NUMBER'), -1) -%}

    {% if number > 1 %}
        {%- trans with {'%number%': number} %}macro.page_number.number{% endtrans -%}
    {% elseif number == 0 %}
        {%- trans with {'%number%': number} %}macro.page_number.all{% endtrans -%}
    {% endif %}
{% endmacro %}
