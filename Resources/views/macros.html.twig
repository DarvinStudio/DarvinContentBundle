{% macro alternate_links(locales) %}
    {%- if app.request and app.request.attributes.has('_route') and app.request.attributes.has('_locale') -%}
        {%- for locale in locales -%}

            {% set url = url(
                app.request.attributes.get('_route'),
                app.request.attributes.get('_route_params', {})|merge({'_locale': locale})|merge(app.request.query.all)
            ) %}

            <link rel="alternate" hreflang="{{ locale }}" href="{{ url }}">
        {%- endfor -%}
    {%- endif -%}
{% endmacro %}

{% macro empty_message(message = 'macro.empty_message.message') %}

    {% set homepage_url = url('darvin_page_homepage') %}
    {% set referer      = app.request.headers.get('referer') %}

    {{ message|trans|raw }}

    <div class="page-error__btns">

        {% if referer starts with(app.request.schemeAndHttpHost) and referer != homepage_url and referer != app.request.uri %}
            <a class="page-error__btn--back" href="{{ referer }}">{% trans %}macro.empty_message.go_back{% endtrans %}</a>
        {% endif %}

        {% if app.request.uri != homepage_url %}
            <a class="page-error__btn--to-home" href="{{ path('darvin_page_homepage') }}">{% trans %}macro.empty_message.to_homepage{% endtrans %}</a>
        {% endif %}

    </div>
{% endmacro %}

{% macro heading(heading) %}

    {%- import '@DarvinContent/macros.html.twig' as darvin_content -%}

    {{- heading }}{{ darvin_content.page_number() -}}
{% endmacro %}

{% macro meta_tags(description) %}

    {%- import '@DarvinContent/macros.html.twig' as darvin_content -%}

    {%- if description -%}
        <meta name="description" content="{{ description }}{{ darvin_content.page_number() }}">
    {% endif %}
{% endmacro %}

{% macro meta_title(title) %}

    {%- import '@DarvinContent/macros.html.twig' as darvin_content -%}

    {{- title }}{{ darvin_content.page_number() -}}
{% endmacro %}

{% macro nav_links() %}
    {% if 1 == app.request.attributes.get('_darvin_content_page_params', [])|length %}

        {% set param = app.request.attributes.get('_darvin_content_page_params')|first %}

        {% for name in ['prev', 'next'] %}

            {% set number = app.request.attributes.get('_darvin_content_page_' ~ name) %}

            {% if number %}

                {% set url = url(
                    app.request.attributes.get('_route'),
                    app.request.attributes.get('_route_params', {})|merge(app.request.query.all)|merge({(param): number})
                ) %}

                <link rel="{{ name }}" href="{{ url }}">
            {% endif %}
        {% endfor %}
    {% endif %}
{% endmacro %}

{% macro page_number() %}

    {%- set number = app.request.attributes.get(constant('Darvin\\ContentBundle\\EventListener\\Pagination\\PagerSubscriber::REQUEST_ATTR_PAGE_NUMBER'), -1) -%}

    {% if number > 1 %}
        {%- trans with {'%number%': number} %}macro.page_number.number{% endtrans -%}
    {% elseif number == 0 %}
        {%- trans with {'%number%': number} %}macro.page_number.all{% endtrans -%}
    {% endif %}
{% endmacro %}

{% macro truncate_html(html, length = 100, suffix = '...') %}

    {% set stripped = html|striptags %}

    {% set stripped_length = stripped|length %}

    {% if stripped_length > length %}
        <p>{{ stripped|slice(0, length)|raw }}{{ suffix }}</p>
    {% else %}
        {{ html|raw }}
    {% endif %}
{% endmacro %}
